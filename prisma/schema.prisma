datasource db {
  provider = "postgresql"
  url      = env("PGSQL")
}

generator client {
  provider             = "prisma-client-py"
  recursive_type_depth = 5
}

model Guild {
  id BigInt @id

  leaderboards Leaderboard[]
  warns        Warn[]

  @@unique([id])
  @@index([id])
  @@map("guilds")
}

model Player {
  id BigInt @id

  leaderboard    Leaderboard @relation(fields: [leaderboard_id], references: [id])
  leaderboard_id Int         @unique

  wins Int

  @@unique([id, leaderboard_id])
  @@index([id, leaderboard_id])
  @@map("players")
}

model Leaderboard {
  id   Int    @id @default(autoincrement())
  name String

  guild    Guild  @relation(fields: [guild_id], references: [id])
  guild_id BigInt @unique

  players Player[]

  @@unique([id, guild_id])
  @@index([id, guild_id])
  @@map("leaderboards")
}

model Warn {
  id Int @id @default(autoincrement())

  member_id  BigInt
  reason     String
  expires_at DateTime

  guild    Guild  @relation(fields: [guild_id], references: [id])
  guild_id BigInt

  @@unique([id, member_id, guild_id])
  @@index([id, guild_id])
  @@map("warns")
}

model Poll {
  id Int @id @default(autoincrement())

  votes Vote[]

  @@unique([id])
  @@index([id])
  @@map("polls")
}

model Vote {
  id Int @id @default(autoincrement())

  poll    Poll @relation(fields: [poll_id], references: [id])
  poll_id Int

  user_id BigInt
  option  Int

  @@unique([id, poll_id, user_id])
  @@index([id, poll_id, user_id])
  @@map("votes")
}
